function [scenario,egoVehicle,estVehicle,traj] = createDrivingScenario
% createDrivingScenario Returns the drivingScenario defined in the Designer

% Construct a drivingScenario object.
scenario = drivingScenario;

% Add all road segments
roadCenters = [-0.2 54.8 0;
    21 55.3 0;
    30.6 54 0;
    46.4 51.3 0;
    54.5 46.8 0;
    57.4 42.3 0;
    57.9 1.8 0;
    33.3 -9.1 0;
    18.3 -9.5 0;
    9.4 -10.5 0;
    -0.2 -10.5 0];
laneSpecification = lanespec(3);
road(scenario, roadCenters, 'Lanes', laneSpecification, 'Name', 'Road');

% Add the barriers
barrierCenters = [51 30.8 0;
    41.5 30.7 0];
barrier(scenario, barrierCenters, ...
    'ClassID', 5, ...
    'Width', 6, ...
    'Height', 8, ...
    'Mesh', driving.scenario.jerseyBarrierMesh, 'PlotColor', [237 177 32] / 255, 'Name', 'Jersey Barrier');

barrierCenters = [67.6 58.8 0;
    56.2 59 0];
barrier(scenario, barrierCenters, ...
    'ClassID', 5, ...
    'Width', 6, ...
    'Height', 8, ...
    'Mesh', driving.scenario.jerseyBarrierMesh, 'PlotColor', [237 177 32] / 255, 'Name', 'Jersey Barrier1');

barrierCenters = [11 6.4 0;
    22.65 5.75 0];
barrier(scenario, barrierCenters, ...
    'ClassID', 5, ...
    'Width', 6, ...
    'Height', 8, ...
    'Mesh', driving.scenario.jerseyBarrierMesh, 'PlotColor', [237 177 32] / 255, 'Name', 'Jersey Barrier2');

barrierCenters = [45.1 59.9 0;
    45.2 65.9 0];
barrier(scenario, barrierCenters, ...
    'ClassID', 5, ...
    'Width', 6, ...
    'Height', 5, ...
    'Mesh', driving.scenario.jerseyBarrierMesh, 'PlotColor', [237 177 32] / 255, 'Name', 'Jersey Barrier3');

barrierCenters = [33.65 28.25 0;
    29.35 36.95 0];
barrier(scenario, barrierCenters, ...
    'ClassID', 5, ...
    'Width', 6, ...
    'Height', 8, ...
    'Mesh', driving.scenario.jerseyBarrierMesh, 'PlotColor', [237 177 32] / 255, 'Name', 'Jersey Barrier4');

barrierCenters = [30 -25.2 0;
    18.95 -25.35 0];
barrier(scenario, barrierCenters, ...
    'ClassID', 5, ...
    'Width', 6, ...
    'Height', 8, ...
    'Mesh', driving.scenario.jerseyBarrierMesh, 'PlotColor', [237 177 32] / 255, 'Name', 'Jersey Barrier5');

barrierCenters = [47.2 5.6 0;
    47.05 16.45 0];
barrier(scenario, barrierCenters, ...
    'ClassID', 5, ...
    'Width', 6, ...
    'Height', 8, ...
    'Mesh', driving.scenario.jerseyBarrierMesh, 'PlotColor', [237 177 32] / 255, 'Name', 'Jersey Barrier6');

barrierCenters = [72.4 3.5527e-15 0;
    72.45 7.65 0];
barrier(scenario, barrierCenters, ...
    'ClassID', 5, ...
    'Width', 4, ...
    'Height', 12, ...
    'Mesh', driving.scenario.jerseyBarrierMesh, 'PlotColor', [237 177 32] / 255, 'Name', 'Jersey Barrier7');

barrierCenters = [63.5 -16.6 0;
    63.55 -8.95 0];
barrier(scenario, barrierCenters, ...
    'ClassID', 5, ...
    'Width', 4, ...
    'Height', 12, ...
    'Mesh', driving.scenario.jerseyBarrierMesh, 'PlotColor', [237 177 32] / 255, 'Name', 'Jersey Barrier9');

barrierCenters = [55.3 -18.6 0;
    45.8 -18.7 0];
barrier(scenario, barrierCenters, ...
    'ClassID', 5, ...
    'Width', 6, ...
    'Height', 8, ...
    'Mesh', driving.scenario.jerseyBarrierMesh, 'PlotColor', [237 177 32] / 255, 'Name', 'Jersey Barrier8');

barrierCenters = [39.1 -19.2 0;
    39.2 -31.9 0];
barrier(scenario, barrierCenters, ...
    'ClassID', 5, ...
    'Width', 6, ...
    'Height', 8, ...
    'Mesh', driving.scenario.jerseyBarrierMesh, 'PlotColor', [237 177 32] / 255, 'Name', 'Jersey Barrier10');

barrierCenters = [31.2 3.4 0;
    31.3 9.4 0];
barrier(scenario, barrierCenters, ...
    'ClassID', 5, ...
    'Width', 6, ...
    'Height', 5, ...
    'Mesh', driving.scenario.jerseyBarrierMesh, 'PlotColor', [237 177 32] / 255, 'Name', 'Jersey Barrier11');

barrierCenters = [38.45 71.35 0;
    26.2 64 0];
barrier(scenario, barrierCenters, ...
    'ClassID', 5, ...
    'Width', 6, ...
    'Height', 6, ...
    'Mesh', driving.scenario.jerseyBarrierMesh, 'PlotColor', [237 177 32] / 255, 'Name', 'Jersey Barrier12');

barrierCenters = [18.5 66.9 0;
    7.45 66.75 0];
barrier(scenario, barrierCenters, ...
    'ClassID', 5, ...
    'Width', 6, ...
    'Height', 8, ...
    'Mesh', driving.scenario.jerseyBarrierMesh, 'PlotColor', [237 177 32] / 255, 'Name', 'Jersey Barrier13');

barrierCenters = [74.1 29.7 0;
    73.5 16.7 0];
barrier(scenario, barrierCenters, ...
    'ClassID', 5, ...
    'Width', 6, ...
    'Height', 6, ...
    'Mesh', driving.scenario.jerseyBarrierMesh, 'PlotColor', [237 177 32] / 255, 'Name', 'Jersey Barrier14');

barrierCenters = [70.1 40 0;
    70.2 46 0];
barrier(scenario, barrierCenters, ...
    'ClassID', 5, ...
    'Width', 6, ...
    'Height', 5, ...
    'Mesh', driving.scenario.jerseyBarrierMesh, 'PlotColor', [237 177 32] / 255, 'Name', 'Jersey Barrier15');

barrierCenters = [8.5 34.8 0;
    13.8 32.9 0;
    18 31.3 0];
barrier(scenario, barrierCenters, ...
    'ClassID', 5, ...
    'Width', 6, ...
    'Height', 8, ...
    'Mesh', driving.scenario.jerseyBarrierMesh, 'PlotColor', [237 177 32] / 255, 'Name', 'Jersey Barrier16');

% Add the ego vehicle
egoVehicle = vehicle(scenario, ...
    'ClassID', 1, ...
    'Length', 4.5, ...
    'Width', 1.8, ...
    'Height', 1.441, ...
    'Position', [-0.2 55.5 0], ...
    'RearOverhang', 1, ...
    'FrontOverhang', 0.9, ...
    'Mesh', driving.scenario.carMesh, ...
    'PlotColor', [0 0 0] / 255, ...
    'Name', 'Car');

% Add the est vehicle
estVehicle = vehicle(scenario, ...
    'ClassID', 1, ...
    'Length', 4.5, ...
    'Width', 1.8, ...
    'Height', 1.441, ...
    'Position', [-4.71305572446913 39.6096170727935 0], ...
    'Mesh', driving.scenario.carMesh, ...
    'PlotColor', [0.71 0.71 0.71], ...
    'Name', 'CarEst');


%Generate the ground Truth trajectory 
sampleRate = 1/scenario.SampleTime;
waypoints = [-0.2 55.5 0;
    8.8 56.4 0;
    15.9 56.3 0;
    24.8 55.6 0;
    35.4 54.4 0;
    44.2 52.8 0;
    53.1 49.5 0;
    58.1 41.8 0;
    61.1 35.3 0;
    63.2 28.8 0;
    64.4 22.3 0;
    63.7 12.9 0;
    60.6 4.7 0;
    56.3 -0.9 0;
    48.1 -6.7 0;
    41.1 -8.6 0;
    34.1 -9.1 0;
    24.4 -9.1 0;
    17.7 -9.6 0;
    12.1 -9.6 0;
    6.4 -9.8 0;
    -0.4 -9.8 0];

%Speed for first methods 
speeds = 2;%m/s
velocity = [speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0];
jerk = 0.4;%m/s^3
traj = waypointTrajectory(Waypoints=waypoints,SampleRate=sampleRate, ...
                          Velocities=velocity,ReferenceFrame="ENU", ...
                          JerkLimit=jerk);



%Velocity vector for second method
velocity = 5; %m/s
speed = [velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity ];

smoothTrajectory(egoVehicle,waypoints,speed,"Jerk",jerk)