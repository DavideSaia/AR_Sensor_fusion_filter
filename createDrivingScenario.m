function [scenario,egoVehicle,estVehicle,traj] = createDrivingScenario
% createDrivingScenario Returns the drivingScenario defined in the Designer

% Construct a drivingScenario object.
scenario = drivingScenario;

% Add all road segments
roadCenters = [-0.2 54.8 0;
    21 55.3 0;
    30.6 54 0;
    46.4 51.3 0;
    54.5 46.8 0;
    57.4 42.3 0;
    57.9 1.8 0;
    33.3 -9.1 0;
    18.3 -9.5 0;
    9.4 -10.5 0;
    -0.2 -10.5 0];
laneSpecification = lanespec(3);
road(scenario, roadCenters, 'Lanes', laneSpecification, 'Name', 'Road');

% Add the Buildings
actor(scenario, ...
    'ClassID', 7, ...
    'Length', 10, ...
    'Width', 5, ...
    'Height', 10, ...
    'Position', [12.7 66.9 0], ...
    'PlotColor', [237 177 32] / 255, ...
    'Name', 'Palace');

actor(scenario, ...
    'ClassID', 7, ...
    'Length', 15, ...
    'Width', 5, ...
    'Height', 7, ...
    'Position', [31.2 65.9 0], ...
    'Yaw', -15, ...
    'PlotColor', [237 177 32] / 255, ...
    'Name', 'Palace1');

actor(scenario, ...
    'ClassID', 7, ...
    'Length', 5, ...
    'Width', 5, ...
    'Height', 11, ...
    'Position', [44.4 63.3 0], ...
    'PlotColor', [237 177 32] / 255, ...
    'Name', 'Palace2');

actor(scenario, ...
    'ClassID', 7, ...
    'Length', 10, ...
    'Width', 5, ...
    'Height', 18, ...
    'Position', [56 59.5 0], ...
    'PlotColor', [237 177 32] / 255, ...
    'Name', 'Palace3');

actor(scenario, ...
    'ClassID', 7, ...
    'Length', 5, ...
    'Width', 5, ...
    'Height', 7, ...
    'Position', [71.6 38.6 0], ...
    'PlotColor', [237 177 32] / 255, ...
    'Name', 'Palace4');

actor(scenario, ...
    'ClassID', 7, ...
    'Length', 14, ...
    'Width', 5, ...
    'Height', 5, ...
    'Position', [73.9 22.3 0], ...
    'Yaw', -90, ...
    'PlotColor', [237 177 32] / 255, ...
    'Name', 'Palace5');

actor(scenario, ...
    'ClassID', 7, ...
    'Length', 7, ...
    'Width', 4, ...
    'Height', 9, ...
    'Position', [70.8 1.3 0], ...
    'Yaw', 90, ...
    'PlotColor', [237 177 32] / 255, ...
    'Name', 'Palace6');

actor(scenario, ...
    'ClassID', 7, ...
    'Length', 7, ...
    'Width', 4, ...
    'Height', 12, ...
    'Position', [63.3 -9.2 0], ...
    'Yaw', 90, ...
    'PlotColor', [237 177 32] / 255, ...
    'Name', 'Palace7');

actor(scenario, ...
    'ClassID', 7, ...
    'Length', 10, ...
    'Width', 5, ...
    'Height', 15, ...
    'Position', [53 -17.1 0], ...
    'PlotColor', [237 177 32] / 255, ...
    'Name', 'Palace8');

actor(scenario, ...
    'ClassID', 7, ...
    'Length', 10, ...
    'Width', 5, ...
    'Height', 10, ...
    'Position', [37.7 -21.9 0], ...
    'Yaw', 90, ...
    'PlotColor', [237 177 32] / 255, ...
    'Name', 'Palace9');

actor(scenario, ...
    'ClassID', 7, ...
    'Length', 10, ...
    'Width', 5, ...
    'Height', 14, ...
    'Position', [22.6 -21.6 0], ...
    'PlotColor', [237 177 32] / 255, ...
    'Name', 'Palace10');

actor(scenario, ...
    'ClassID', 7, ...
    'Length', 10, ...
    'Width', 5, ...
    'Height', 18, ...
    'Position', [8.3 -23 0], ...
    'Yaw', -30, ...
    'PlotColor', [237 177 32] / 255, ...
    'Name', 'Palace11');

actor(scenario, ...
    'ClassID', 7, ...
    'Length', 10, ...
    'Width', 5, ...
    'Height', 11, ...
    'Position', [45.9 34.7 0], ...
    'PlotColor', [237 177 32] / 255, ...
    'Name', 'Palace12');

actor(scenario, ...
    'ClassID', 7, ...
    'Length', 10, ...
    'Width', 5, ...
    'Height', 7, ...
    'Position', [44.3 7.6 0], ...
    'Yaw', -90, ...
    'PlotColor', [237 177 32] / 255, ...
    'Name', 'Palace13');

actor(scenario, ...
    'ClassID', 7, ...
    'Length', 10, ...
    'Width', 5, ...
    'Height', 9, ...
    'Position', [29.1 38.7 0], ...
    'Yaw', -60, ...
    'PlotColor', [237 177 32] / 255, ...
    'Name', 'Palace14');

actor(scenario, ...
    'ClassID', 7, ...
    'Length', 10, ...
    'Width', 5, ...
    'Height', 8, ...
    'Position', [13.9 42.3 0], ...
    'Yaw', -23, ...
    'PlotColor', [237 177 32] / 255, ...
    'Name', 'Palace15');

actor(scenario, ...
    'ClassID', 7, ...
    'Length', 5, ...
    'Width', 5, ...
    'Height', 5, ...
    'Position', [28.8 0.6 0], ...
    'PlotColor', [237 177 32] / 255, ...
    'Name', 'Palace16');

actor(scenario, ...
    'ClassID', 7, ...
    'Length', 12, ...
    'Width', 5, ...
    'Height', 6, ...
    'Position', [10.9 0.9 0], ...
    'PlotColor', [237 177 32] / 255, ...
    'Name', 'Palace17');

actor(scenario, ...
    'ClassID', 7, ...
    'Length', 10, ...
    'Width', 5, ...
    'Height', 8, ...
    'Position', [66.3 50.9 0], ...
    'Yaw', 90, ...
    'PlotColor', [237 177 32] / 255, ...
    'Name', 'Palace18');

% Add the ego vehicle
egoVehicle = vehicle(scenario, ...
    'ClassID', 1, ...
    'Length', 4.5, ...
    'Width', 1.8, ...
    'Height', 1.441, ...
    'Position', [-0.2 55.5 0], ...
    'RearOverhang', 1, ...
    'FrontOverhang', 0.9, ...
    'Mesh', driving.scenario.carMesh, ...
    'PlotColor', [0 0 0] / 255, ...
    'Name', 'Car');

% Add the est vehicle
estVehicle = vehicle(scenario, ...
    'ClassID', 1, ...
    'Length', 4.5, ...
    'Width', 1.8, ...
    'Height', 1.441, ...
    'Position', [-4.71305572446913 39.6096170727935 0], ...
    'Mesh', driving.scenario.carMesh, ...
    'PlotColor', [0.71 0.71 0.71], ...
    'Name', 'CarEst');


%Generate the ground Truth trajectory 
sampleRate = 1/scenario.SampleTime;
waypoints = [-0.2 55.5 0;
    8.8 56.4 0;
    15.9 56.3 0;
    24.8 55.6 0;
    35.4 54.4 0;
    44.2 52.8 0;
    53.1 49.5 0;
    58.1 41.8 0;
    61.1 35.3 0;
    63.2 28.8 0;
    64.4 22.3 0;
    63.7 12.9 0;
    60.6 4.7 0;
    56.3 -0.9 0;
    48.1 -6.7 0;
    41.1 -8.6 0;
    34.1 -9.1 0;
    24.4 -9.1 0;
    17.7 -9.6 0;
    12.1 -9.6 0;
    6.4 -9.8 0;
    -0.4 -9.8 0];

%Speed for first methods 
speeds = 2;%m/s
velocity = [speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0;
         speeds 0 0];
jerk = 0.4;%m/s^3
traj = waypointTrajectory(Waypoints=waypoints,SampleRate=sampleRate, ...
                          Velocities=velocity,ReferenceFrame="ENU", ...
                          JerkLimit=jerk);



%Velocity vector for second method
velocity = 5; %m/s
speed = [velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity 
         velocity ];

smoothTrajectory(egoVehicle,waypoints,speed,"Jerk",jerk)